{% extends 'auth_template/base.html' %}
{% load static %}
{% block content %}

<div class="container h-p100">
	<div class="row align-items-center justify-content-md-center h-p100">
		<div class="col-12">
			<div class="row justify-content-center g-0">
				<div class="col-lg-5 col-md-5 col-12">
					<div class="bg-white rounded10 shadow-lg">
						<div class="content-top-agile p-20 pb-0">
							<h2 class="text-primary">Connectez-vous</h2>
							<p class="mb-0">Renseignez vos coordonnÃ©es pour accÃ©der Ã  votre compte.</p>

							{% if messages %}
								{% for message in messages %}
									<span class="alert" style="color:red;" role="alert">{{ message }}</span>
								{% endfor %}
							{% endif %}
						</div>

						<div class="p-40">
							<form action="{% url 'Connexion' %}" method="post" id="loginForm" autocomplete="off">
								{% csrf_token %}
								
								<div class="form-group">
									<div class="input-group mb-3">
										<span class="input-group-text bg-transparent"><i class="ti-user"></i></span>
										{{ form.username }}
									</div>
								</div>

								<div class="form-group">
									<div class="input-group mb-3">
										<span class="input-group-text bg-transparent"><i class="ti-lock"></i></span>
										{{ form.password }}
									</div>
								</div>

								<!-- Cabinet affichÃ© automatiquement -->
								<div class="form-group">
									<div class="input-group mb-3">
										<span class="input-group-text bg-transparent"><i class="ti-briefcase"></i></span>
										<input type="text" id="cabinetName" name="cabinetName"
											   class="form-control" placeholder="Cabinet"
											   value="{{ cabinet_name }}" readonly>
									</div>
								</div>

								<div class="col-12 text-center">
									<button type="submit" id="loginBtn" class="btn btn-success mt-10">Se connecter</button>
								</div>
							</form>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	// ðŸ”¸ Afficher automatiquement le nom du cabinet
	const usernameInput = document.querySelector('#id_username');
	const cabinetField = document.querySelector('#cabinetName');
	const loginBtn = document.querySelector('#loginBtn');
	const form = document.querySelector('#loginForm');

	usernameInput.addEventListener('input', function() {
		const username = this.value;
		if (username.length > 0) {
			fetch(`/get-cabinet-name/?username=${username}`)
				.then(response => response.json())
				.then(data => {
					cabinetField.value = data.cabinet_name || "";
				})
				.catch(err => console.error(err));
		} else {
			cabinetField.value = "";
		}
	});

	// ðŸ”¸ EmpÃªcher les clics multiples
	form.addEventListener('submit', function() {
		loginBtn.disabled = true;
		loginBtn.innerText = "Connexion...";
	});
});
</script>

{% endblock %}
